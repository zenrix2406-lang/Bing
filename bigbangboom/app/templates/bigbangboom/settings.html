{% extends "base.html" %}
{% block title %}AI Settings — BigBangBoom{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-7 col-xl-6">
    <h4 class="fw-bold mb-4"><i class="bi bi-gear me-2 bbb-text-glow"></i>AI Settings</h4>

    <div class="bbb-card p-4">
      <p class="text-secondary small mb-4">
        BigBangBoom AI uses <strong>your own API key</strong> to talk to the AI provider of your choice.
        Your key is stored in the database and never shared.
      </p>

      <form method="POST" action="{{ url_for('bbb.settings') }}">

        <div class="mb-4">
          <label class="form-label fw-medium">AI Provider</label>
          <select name="provider" class="form-select bbb-input">
            {% for p in providers %}
            <option value="{{ p.id }}"
              {% if current_user.ai_provider == p.id %}selected{% endif %}>
              {{ p.label }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-4">
          <label class="form-label fw-medium">API Key</label>
          <div class="input-group">
            <input type="password" id="api_key" name="api_key"
                   class="form-control bbb-input font-monospace"
                   value="{{ current_user.ai_api_key or '' }}"
                   placeholder="Paste your API key here…"
                   autocomplete="off" />
            <button type="button" class="btn btn-outline-secondary" id="toggle-key" title="Show/Hide">
              <i class="bi bi-eye" id="eye-icon"></i>
            </button>
          </div>
          {% if current_user.ai_api_key %}
          <div class="form-text text-success">
            <i class="bi bi-check-circle-fill me-1"></i>Key is configured. Leave blank to clear it.
          </div>
          {% else %}
          <div class="form-text text-secondary">No key set yet.</div>
          {% endif %}
        </div>

        <div class="text-end">
          <button type="submit" class="btn bbb-btn-primary px-5">
            <i class="bi bi-save me-1"></i>Save Settings
          </button>
        </div>
      </form>
    </div>

    <!-- Provider key links -->
    <div class="bbb-tip-card mt-4 p-4">
      <h6 class="fw-semibold mb-3"><i class="bi bi-key-fill text-warning me-2"></i>Where to get API keys</h6>
      <ul class="text-secondary small mb-0" style="line-height:2.2;">
        <li><strong>OpenAI:</strong> <a href="https://platform.openai.com/api-keys" target="_blank" class="bbb-link">platform.openai.com/api-keys</a></li>
        <li><strong>Groq:</strong> <a href="https://console.groq.com/" target="_blank" class="bbb-link">console.groq.com</a></li>
        <li><strong>Mistral:</strong> <a href="https://console.mistral.ai/" target="_blank" class="bbb-link">console.mistral.ai</a></li>
        <li><strong>Anthropic:</strong> <a href="https://console.anthropic.com/" target="_blank" class="bbb-link">console.anthropic.com</a></li>
        <li><strong>Google:</strong> <a href="https://aistudio.google.com/" target="_blank" class="bbb-link">aistudio.google.com</a></li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  document.getElementById('toggle-key').addEventListener('click', function () {
    const inp = document.getElementById('api_key');
    const icon = document.getElementById('eye-icon');
    if (inp.type === 'password') {
      inp.type = 'text';
      icon.className = 'bi bi-eye-slash';
    } else {
      inp.type = 'password';
      icon.className = 'bi bi-eye';
    }
  });
</script>
{% endblock %}
