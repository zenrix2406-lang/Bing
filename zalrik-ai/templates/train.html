{% extends "base.html" %}
{% block title %}Train â€” Zalrik AI{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">

    <div class="d-flex align-items-center gap-3 mb-4">
      <span style="font-size:2.2rem;">ðŸŽ“</span>
      <div>
        <h4 class="fw-bold mb-0 zalrik-gradient">Train Zalrik AI</h4>
        <p class="text-secondary mb-0 small">
          Enter prompts to teach Zalrik. It will follow every instruction you give it.
          Currently using: <code class="text-info">{{ model }}</code>
        </p>
      </div>
    </div>

    <!-- Add new training prompt -->
    <div class="card bg-dark border-secondary mb-4">
      <div class="card-header border-secondary py-2">
        <h6 class="mb-0 fw-semibold">
          <i class="bi bi-plus-circle-fill me-2 text-success"></i>Add a Training Prompt
        </h6>
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('train') }}">
          <input type="hidden" name="action" value="add" />
          <div class="mb-3">
            <label for="prompt_text" class="form-label small text-secondary">
              Describe a behaviour, skill, or rule for Zalrik to follow:
            </label>
            <textarea id="prompt_text" name="prompt_text"
                      class="form-control bg-secondary border-0 text-white"
                      rows="3"
                      placeholder="e.g. Always reply in the style of a pirate.&#10;e.g. When I say 'code it', write the full working Python code.&#10;e.g. Remember that my name is Zenrix and always greet me by name."
                      required></textarea>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <div class="text-secondary small">
              <i class="bi bi-lightbulb-fill text-warning me-1"></i>
              Training prompts shape Zalrik's personality and skills for your entire session.
            </div>
            <button type="submit" class="btn btn-success btn-sm px-4 ms-3">
              <i class="bi bi-mortarboard-fill me-1"></i>Teach Zalrik
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Existing training prompts -->
    <div class="card bg-dark border-secondary">
      <div class="card-header border-secondary py-2 d-flex align-items-center justify-content-between">
        <h6 class="mb-0 fw-semibold">
          <i class="bi bi-list-ul me-2 text-info"></i>
          Current Training Prompts
          <span class="badge bg-info text-dark ms-1">{{ training_prompts | length }}</span>
        </h6>
        {% if training_prompts %}
        <form method="POST" action="{{ url_for('train') }}"
              onsubmit="return confirm('Clear all training prompts?');">
          <input type="hidden" name="action" value="clear_all" />
          <button type="submit" class="btn btn-sm btn-outline-danger py-0 px-2">
            <i class="bi bi-trash me-1"></i>Clear all
          </button>
        </form>
        {% endif %}
      </div>
      <div class="card-body">
        {% if training_prompts %}
          <div class="d-flex flex-column gap-2">
            {% for tp in training_prompts %}
            <div class="d-flex align-items-start gap-2 p-3 rounded-3 bg-secondary bg-opacity-20 border border-secondary">
              <span class="badge bg-warning text-dark flex-shrink-0 mt-1">{{ loop.index }}</span>
              <div class="flex-grow-1 small text-white" style="white-space:pre-wrap;">{{ tp }}</div>
              <form method="POST" action="{{ url_for('train') }}" class="flex-shrink-0">
                <input type="hidden" name="action" value="delete" />
                <input type="hidden" name="idx" value="{{ loop.index0 }}" />
                <button type="submit" class="btn btn-sm btn-outline-danger py-0 px-1"
                        title="Delete this prompt"
                        onclick="return confirm('Remove this training prompt?');">
                  <i class="bi bi-x-lg"></i>
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center text-secondary py-4">
            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
            <p class="mb-0">No training prompts yet.<br>
              Add one above to start teaching Zalrik AI!</p>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="mt-4 text-center">
      <a href="{{ url_for('chat') }}" class="btn btn-primary px-5">
        <i class="bi bi-chat-dots-fill me-2"></i>Go chat with Zalrik
      </a>
    </div>

  </div>
</div>
{% endblock %}
